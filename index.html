<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SAMS - CUEA</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/assets/css/styles.css" />
    <link rel="icon" href="/assets/images/CUEA-LOGO.png" />
  </head>
  <body>
    <div
      class="container-fluid vh-100 d-flex flex-column justify-content-center align-items-center"
      id="landing-page"
    >
      <div id="loader" class="text-center">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2">Loading SAMS...</p>
      </div>

      <div id="content" class="text-center d-none">
        <h1 class="display-4 fw-bold text-primary mb-3">
          Student Affairs Management System
        </h1>
        <p class="lead mb-4">Catholic University of Eastern Africa</p>
        <a href="/html/login.html" class="btn btn-primary btn-lg"
          >Login to Continue</a
        >
      </div>
    </div>

    <!-- Supabase -->
    <script type="module">
      import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

      // Supabase setup
      const SUPABASE_URL = process.env.SUPABASE_URL;
      const SUPABASE_ANON_KEY = process.env.SUPABASE_ANON_KEY;

      const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      const loader = document.getElementById("loader");
      const content = document.getElementById("content");

      // Auto-redirect logged-in users
      const checkAuth = async () => {
        const {
          data: { session },
        } = await supabase.auth.getSession();
        if (session) {
          window.location.href = "/html/student-dashboard.html";
        } else {
          loader.style.display = "none";
          content.classList.remove("d-none");
        }
      };

      checkAuth();

      // Optional: Listen for auth changes (if user logs in/out on same page)
      supabase.auth.onAuthStateChange((event, session) => {
        if (session) window.location.href = "/html/student-dashboard.html";
      });
    </script>
  </body>
</html>
